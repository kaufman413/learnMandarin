<!-- Source template: http://www.w3schools.com/w3css/tryit.asp?filename=tryw3css_templates_interior_design&stacked=h-->

{% load static %}

<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link type="text/css" rel="stylesheet" href="{% static 'homepage/css/w3.css' %}">
<link type="text/css" rel="stylesheet" href="{% static 'homepage/css/Poppins-font.css' %}">
<script src="{% static 'homepage/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'homepage/js/jquery.flip.js' %}" type="text/javascript"></script>
<script src="{% static 'homepage/js/jquery.cookie.js' %}"></script>
<script src="{% static 'homepage/js/shuffle.js' %}"></script>


<link href="{% static 'homepage/css/box_main.css' %}" type="text/css" rel="stylesheet"/>

<style type="text/css">
body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
body {font-size:16px;}
.w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
.w3-half img:hover{opacity:1}


        .button {
            margin: 5px;
            border-radius: 10px;
            background-color: white;
        }
        button:focus {outline:0;}


</style>

<script>

    var basePoints = {{points}};

    function ajaxPractice(amount) {
        xhttp = new XMLHttpRequest();
        xhttp.open("GET", "ajaxPractice/{{username}}/"+amount, true);
        xhttp.send();
        basePoints += amount;
        document.getElementById("points").innerHTML = "Points = "+basePoints;
    }



</script>

<body onkeydown="flip()" style="background-color: lightcyan">



<!-- Sidenav/menu -->
<nav class="w3-sidenav w3-deep-purple w3-collapse w3-top w3-large w3-padding" style="z-index:3;width:300px;font-weight:bold" id="mySidenav"><br>
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-padding-xlarge w3-hide-large w3-display-topleft w3-hover-white" style="width:100%;font-size:22px">Close Menu</a>
  <div class="w3-container">
    <h3 class="w3-padding-32">
        <b>Learn<br>Mandarin</b>
    </h3>
    <h3 id="points" class="w3-padding-8">
        Points = {{points}}
    </h3>

  </div>
  <a href="../../main" onclick="w3_close()" class="w3-padding w3-hover-white">Home</a>
  <a href="logoff" onclick="w3_close()" class="w3-padding w3-hover-white">Logout</a>
  <!--a href="#learn" onclick="w3_close()" class="w3-padding w3-hover-white">Learn</a>
  <a href="#review" onclick="w3_close()" class="w3-padding w3-hover-white">Review</a-->
</nav>

<!-- Top menu on small screens -->
<header class="w3-container w3-top w3-hide-large w3-deep-purple w3-xlarge w3-padding">
  <a href="javascript:void(0)" class="w3-btn w3-deep-purple w3-border w3-border-white w3-margin-right" onclick="w3_open()">☰</a>
  <span>Company Name</span>
</header>

<!-- Overlay effect when opening sidenav on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>



<div id="form"></div>



<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:340px;margin-right:40px">






<!-- FIRST PART -->


  <!-- Learn / Header -->
  <div class="w3-container" style="margin-top:20px" id="learn">
    <h1 class="w3-jumbo"><b>Lesson {{lesson.number}}</b></h1>
    <p>{{lesson.text}}</p>
    <div class="w3-row-padding">

    <div id="text" style="font-size:15px; text-align: center">
      <button onclick="toggle_mode('cards')" class="button" id="cards_button" style="background-color:red">Cards</button>
      <button onclick="toggle_mode('learn')" class="button" id="learn_button">Learn</button>
      <button onclick="toggle_mode('quiz')" class="button" id="quiz_button">Quiz</button>
        <div id="count" style="text-align: center;"></div>
    </div>
  </div>
  <div class="w3-row-padding">
    <div id="card">
      <div id="front" class="front" style="font-weight:200; border-style:solid; background-color:white; text-align:center; background-repeat: no-repeat; background-size: 256px 256px; background-image: url('{% static "homepage/img/" %}{{words.0.picture}}')">
          {{words.0.characters}}<br>
          <button id="pinyin" style="font-size:20px; background-color:white; border-style: none;" onclick="var but=document.getElementById('pinyin'); but.innerHTML=but.value;" value="{{words.0.pinyin}}">Show pinyin</button>
          <audio autoplay="autoplay"> <source src="{% static "homepage/audio/" %}{{words.0.audio}}"></audio>
      </div>
      <div id="back" class="back" style="font-weight:200; border-style:solid;background-color:white;text-align:center">
            {{words.0.characters}}<br>{{words.0.english}}
      </div>
    </div>
  </div>

    <div id="box" style="display:none">
      <div id="learn">
      </div>
      <div id="quiz">
      </div>
    </div>

  </div>


</div>
<!-- SECOND PART -->




<!-- End page content -->


<!-- W3.CSS Container -->
<div class="w3-light-grey w3-container w3-padding-2" style="margin-top:75px;padding-right:58px"><p class="w3-right">Powered by <a href="http://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></p></div>

<script>
// Script to open and close sidenav
function w3_open() {
    document.getElementById("mySidenav").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}

function w3_close() {
    document.getElementById("mySidenav").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}

// Modal Image Gallery
function onClick(element) {
  document.getElementById("img01").src = element.src;
  document.getElementById("modal01").style.display = "block";
  var captionText = document.getElementById("caption");
  captionText.innerHTML = element.alt;
}
</script>



<!-- FLASHCARD SCRIPT -->

<script>
    function learnButtonClicked(buttonNumber) {
        var answer = document.getElementById("button1").value; //actual value is hidden in button1
        var evaluation = "";
        if(buttonNumber == answer) {
            evaluation = "correct! +2<br><button onclick='flip();'>NEXT</button>";
            ajaxPractice(2);
        }
        else {
            evaluation = "incorrect!<br><button onclick='flip();'>NEXT</button>";
        }
        $("#back").html(evaluation);
        $("#card").flip(true);

    }

</script>

<script>

        var i = 0;
        var flipped = false;
        var mode = "cards"; //could also be "quiz" or "learn"

        //[character,english,audio,picture,pinyin]
        var words = [ {% for word in words %} [ '{{word.characters}}', '{{word.english}}','{% static "homepage/audio/" %}' + ('{{word.audio}}'), '{% static "homepage/img/" %}' + ('{{word.picture}}'), '{{word.pinyin}}'],{% endfor %}]
        var testWords = shuffle(words.slice());
        //[audio,thingToGuess,option1,option2,answer] (answer=1|2)
        var learnWords = [{% for word in learnWords %} ['{% static "homepage/audio/" %}' + ('{{word.0}}'),'{{word.1}}','{{word.2}}','{{word.3}}', {{word.4}}], {% endfor %}]//[{% for word in learnWords %} [], {% endfor %}]
        //var english = ['Hi','How are you?','I am good.'];
        //var foreign = ['你好','你好吗','我很好'];

        function flip(e) {
            var e = e || event;
            if (mode == 'cards') {
                if (e.keyCode == 38 || e.keyCode == 32 || e.keyCode == 40) { //up, down, or spacebar
                    $("#card").flip('toggle');
                }
                else if (e.keyCode == 37) { //left
                    if (i >= 1) {
                        i -= 1;
                    }
                    else {
                        return "None";
                    }
                    $("#card").hide();
                    $("#card").flip(false);
                    $("#front").html(words[i][0] + ("<br>") + ("<button id=\"pinyin\" style=\"font-size:20px; background-color:white; border-style: none;\" onclick=\"var but=document.getElementById('pinyin'); but.innerHTML=but.value;\" value=\"" + (words[i][4]) + ("\">Show pinyin</button>")) + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"" + (words[i][2] + ("\"></audio>"))));
                    $("#back").html(words[i][0] + "<br>" + words[i][1]);
                    $("#front").css("background-image", "url('" + (words[i][3]) + ("')"));
                    $("#card").fadeIn();
                }
                else if (e.keyCode == 39) { //right
                    if (i < words.length - 1) {
                        i += 1;
                    }
                    else {
                        toggle_mode("learn");
                        return "None"
                    }
                    $("#card").hide();
                    $("#card").flip(false);
                    $("#front").html(words[i][0] + ("<br>") + ("<button id=\"pinyin\" style=\"font-size:20px; background-color:white; border-style: none;\" onclick=\"var but=document.getElementById('pinyin'); but.innerHTML=but.value;\" value=\"" + (words[i][4]) + ("\">Show pinyin</button>")) + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"" + (words[i][2] + ("\"></audio>"))));
                    $("#back").html(words[i][0] + "<br>" + words[i][1]);
                    $("#front").css("background-image", "url('" + (words[i][3]) + ("')"));
                    $("#card").fadeIn();
                }
                $("#count").html(i +1 + "/" + (words.length));
            }


            else if(mode == 'learn') {
                if(flipped==false) {
                    i += 1;
                    flipped = true;
                    if (e.keyCode == 37) { //left button
                        learnButtonClicked(1);
                    }
                    else if(e.keyCode == 39) { //right button
                        learnButtonClicked(2);
                    }

                }
                else if(flipped==true && (e.keyCode == 32 || e.keyCode == undefined)) {
                    flipped = false;
                    $("#card").hide();
                    $("#card").flip(false);
                    $("#front").html(learnWords[i][1] + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"") + (learnWords[i][0]) + ("\"></audio><br>") + ("<button id='button1' value='"+learnWords[i][4]+"' onclick=' i+=1; flipped=true; learnButtonClicked(1); ' style='color:white; width: 150px; margin: 20px; font-size:30px; border-radius: 5px; background-color: black'>") + (learnWords[i][2]) + ("</button>") + ("<button onclick='i+=1; flipped=true; learnButtonClicked(2); ' style='color:white; width: 150px; margin: 20px; font-size:30px; border-radius: 5px; background-color: black'>") + (learnWords[i][3]) + ("</button>"));
                    $("#count").html(i +1+ "/" + (learnWords.length));
                    $("#card").fadeIn();

                    if(i==learnWords.length-1){
                        toggle_mode('quiz');
                    }

                }

            }


            else if(mode == 'quiz') {
                if(e.keyCode == 13 || e.keyCode == undefined) { //if the user pressed enter or clicked the submit button

                    //here we check if user put in the correct input
                    if(flipped == false) {
                        var userInput = $("#learnInput").val();
                        var correctAnswer = testWords[i][1];
                        var evaluation = "";


                        //user input was correct
                        if (userInput.toLowerCase() == correctAnswer.toLowerCase() || userInput.toLowerCase() == correctAnswer.toLowerCase().substring(0, correctAnswer.length-1)) {
                            evaluation = "对! :) +5 ";
                            ajaxPractice(5);
                        }
                        //user input was incorrect
                        else {
                            evaluation = "不对! :(";
                        }
                        //change back to either correct or incorrect depending
                        //on if the user's input matches the word
                        $("#back").html(evaluation + ("<br>") + (testWords[i][1]) + ("<button onclick='flip()' style=\"font-size: 16px;\">Next-></button>"));
                        $("#card").flip(true);
                        flipped = true;
                        if(userInput.toLowerCase() == correctAnswer.toLowerCase() || userInput.toLowerCase() == correctAnswer.toLowerCase().substring(0, correctAnswer.length-1)) {
                            testWords.splice(i, 1);
                        }
                        else {
                            i+=1;
                        }
                        if(i==testWords.length) {
                            i = 0;
                        }

                    }
                    else if(flipped == true) {
                        if(i==testWords.length && i==0) {window.location.href += "/questions";} //was i=0;
                        $("#card").hide();
                        $("#card").flip(false);
                        flipped = false;

                        $("#front").html(testWords[i][0] + ("<div id=\"input\" style=\"font-size:16px;\"><input autofocus type=\"text\" id=\"learnInput\"><br><br><button onclick='flip()'>Enter</button></div>") + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"" + (testWords[i][2] + ("\"></audio>"))));
                        $("#count").html(i +1+ "/" + (testWords.length));
                        $("#card").fadeIn();
                        document.getElementById("learnInput").focus();

                    }

                }

            }
        }
            //if(e.keyCode == undefined ) {var lksdjf  = 12;} //this is when it is clicked}



        function toggle_mode(local_mode) {
            //var back_color_selected = '#a41515';
            var cards_back_color_selected = 'red';
            var learn_back_color_selected = 'yellow';
            var quiz_back_color_selected = 'green';
            var back_color_unselected = 'white';

            if(local_mode == 'cards') {
                $("#cards_button").blur();
                $("#cards_button").css('background-color', cards_back_color_selected);
                $("#learn_button").css('background-color', back_color_unselected);
                $("#quiz_button").css('background-color', back_color_unselected);
                mode = 'cards';
                i = 0;
                $("#card").hide();
                $("#card").flip(false);
                $("#front").html(words[i][0] + ("<br>") + ("<button id=\"pinyin\" style=\"font-size:20px; background-color:white; border-style: none;\" onclick=\"var but=document.getElementById('pinyin'); but.innerHTML=but.value;\" value=\"" + (words[i][4]) + ("\">Show pinyin</button>")) + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"" + (words[i][2] + ("\"></audio>"))));
                $("#back").html(words[i][0] + "<br>" + words[i][1]);
                $("#card").fadeIn();
                $("#count").html(i +1+ "/" + (words.length));
            }

            //WE ARE TRYING TO BUILD READING AND LISTENING COMPREHENSION
            //options for learn:
            // prompt / 2-4 options (there is pinyin, character, english, and maybe (audio, picture))
            //
            //
            //
            else if (local_mode == 'learn') {
                learnWords = shuffle(learnWords);
                $("#learn_button").blur();
                $("#cards_button").css('background-color', back_color_unselected);
                $("#learn_button").css('background-color', learn_back_color_selected);
                $("#quiz_button").css('background-color', back_color_unselected);
                mode = 'learn';
                //reset i to 0 and then pull from the learnWords array
                i = 0;
                $("#card").hide();
                $("#card").flip(false);
                $("#front").html(learnWords[i][1] + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"") + (learnWords[i][0]) + ("\"></audio><br>") + ("<button id='button1' value='"+learnWords[i][4]+"' onclick=' i+=1; flipped=true; learnButtonClicked(1); ' style='color:white; width: 150px; margin: 20px; font-size:30px; border-radius: 5px; background-color: black'>") + (learnWords[i][2]) + ("</button>") + ("<button onclick='i+=1; flipped=true; learnButtonClicked(2); ' style='color:white; width: 150px; margin: 20px; font-size:30px; border-radius: 5px; background-color: black'>") + (learnWords[i][3]) + ("</button>"));
                $("#card").fadeIn();
                $("#count").html(i +1+ "/" + (learnWords.length));
            }

            else if (local_mode == 'quiz') {
                $("#quiz_button").blur();
                $("#cards_button").css('background-color', back_color_unselected);
                $("#learn_button").css('background-color', back_color_unselected);
                $("#quiz_button").css('background-color', quiz_back_color_selected);
                mode = 'quiz';
                //reset cards and add a format that allows user to enter an answer
                i = 0;
                $("#card").hide();
                $("#card").flip(false);
                $("#front").html(testWords[i][0] + ("<div id=\"input\" style=\"font-size:16px;\"><input autofocus type=\"text\" id=\"learnInput\"><br><br><button onclick='flip()'>Enter</button></div>") + ("<audio type='audio/m4a' autoplay=\"autoplay\"> <source src=\"" + (testWords[i][2] + ("\"></audio>"))));
                $("#card").fadeIn();
                $("#count").html(i +1+ "/" + (testWords.length ));

            }
        }

        $(function () {
            if(mode == "cards") {
                $("#count").html(i+1+"/"+(words.length));
            }
            else if(mode == "learn") {
                $("#count").html(i + 1 + "/" + (learnWords.length));
            }
            else if(mode == "quiz") {
                $("#count").html(i+1+"/"+(testWords.length));
            }
            $("#card").flip({'axis':'x', 'trigger':'manual'});
        });


    </script>




</body>
</html>